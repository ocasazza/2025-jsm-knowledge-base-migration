<ac:layout>
 <ac:layout-section ac:type="single">
  <ac:layout-cell>
   <p>
    <ac:placeholder>
     Add labels to this report to make it easy to find outages that relate to the service or the sites that were affected. That will help us find and report on relevant related issues.
    </ac:placeholder>
   </p>
   <ac:structured-macro ac:macro-id="6041cfab-a8b7-40c8-aa32-0229b207b0df" ac:name="excerpt" ac:schema-version="1">
    <ac:parameter ac:name="atlassian-macro-output-type">
     INLINE
    </ac:parameter>
    <ac:rich-text-body>
     <p>
      SIR for Multiple VMs offline on Nov 18, 2021
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
 </ac:layout-section>
 <ac:layout-section ac:type="two_equal">
  <ac:layout-cell>
   <p class="auto-cursor-target">
    <br/>
   </p>
   <ac:structured-macro ac:macro-id="b2a57857-7f56-44d2-a0d4-91b3d7ebfcbf" ac:name="toc-zone" ac:schema-version="1">
    <ac:rich-text-body>
     <p>
      <ac:structured-macro ac:macro-id="58b18781-a929-4005-a5e0-2ef23adca3fe" ac:name="toc" ac:schema-version="1">
      </ac:structured-macro>
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
  <ac:layout-cell>
   <p class="auto-cursor-target">
    <br/>
   </p>
   <ac:structured-macro ac:macro-id="0db3d9b8-3a8d-4ad4-ae26-0a4ea4bc95c2" ac:name="details" ac:schema-version="1">
    <ac:parameter ac:name="id">
     SIR-metadata
    </ac:parameter>
    <ac:rich-text-body>
     <p class="auto-cursor-target">
      <br/>
     </p>
     <table class="wrapped" style="letter-spacing: 0.0px;">
      <colgroup>
       <col/>
       <col/>
      </colgroup>
      <tbody>
       <tr>
        <th colspan="1">
         System/Service
        </th>
        <td colspan="1">
         <ac:link>
          <ri:page ri:content-title="VMware" ri:space-key="SYSMGR">
          </ri:page>
         </ac:link>
        </td>
       </tr>
       <tr>
        <th>
         Ticket(s)
        </th>
        <td>
         <div class="content-wrapper">
          <p>
           <ac:structured-macro ac:macro-id="19adb748-9294-4ca0-a83c-7d854381f0b5" ac:name="jira" ac:schema-version="1">
            <ac:parameter ac:name="server">
             System JIRA
            </ac:parameter>
            <ac:parameter ac:name="columnIds">
             issuekey,summary,issuetype,created,updated,duedate,assignee,reporter,priority,status,resolution
            </ac:parameter>
            <ac:parameter ac:name="columns">
             key,summary,type,created,updated,due,assignee,reporter,priority,status,resolution
            </ac:parameter>
            <ac:parameter ac:name="serverId">
             ac6def98-2140-30c3-8103-4b52b8b31135
            </ac:parameter>
            <ac:parameter ac:name="key">
             SYSMGR-61325
            </ac:parameter>
           </ac:structured-macro>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th colspan="1">
         Outage scope
        </th>
        <td colspan="1">
         Git, CGit, OpenGrok, DHCP
        </td>
       </tr>
       <tr>
        <th>
         Outage date
        </th>
        <td>
         <div class="content-wrapper">
          <p>
           <time datetime="2021-11-18">
           </time>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th>
         Report date
        </th>
        <td>
         <div class="content-wrapper">
          <p>
           <time datetime="2021-11-18">
           </time>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th colspan="1">
         Report filed by
        </th>
        <td colspan="1">
         <div class="content-wrapper">
          <p>
           <ac:link>
            <ri:user ri:userkey="557058:037cebc0-7a1a-4a12-af72-7583a24ff5d6">
            </ri:user>
           </ac:link>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th colspan="1">
         Report reviewed date
        </th>
        <td colspan="1">
         <ac:placeholder>
          Use date macro for the date the report was reviewed with the team or relevant stakeholders
         </ac:placeholder>
        </td>
       </tr>
      </tbody>
     </table>
     <p class="auto-cursor-target">
      <br/>
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
 </ac:layout-section>
 <ac:layout-section ac:type="single">
  <ac:layout-cell>
   <h2>
    Executive summary
   </h2>
   <hr/>
   <p>
    Services were disrupted for ~30m when multiple VMs were taken offline during business hours.
   </p>
   <p>
    <br/>
   </p>
   <h2>
    <span>
     Background
    </span>
   </h2>
   <hr/>
   <p>
    <br/>
   </p>
   <h2>
    Incident Description
   </h2>
   <hr/>
   <p>
    A failed drive on a VxRail node necessitated maintenance on that node. The physical labels on two nodes had been reversed, leading to the wrong drive being pulled from an online hypervisor. Affected VMs were restarted on other nodes and the error was noticed almost immediately and corrected. The actual faulty drive was replaced and most services were restored within 36m, the exceptions being cgit and spacewalk.
   </p>
   <h3>
    Chronology
   </h3>
   <p>
    <time datetime="2021-11-16">
    </time>
   </p>
   <p>
    A drive fails on pdx-vxr-e02 and vSAN begins migrating data away from the disk group,
    <ac:link>
     <ri:user ri:userkey="557058:037cebc0-7a1a-4a12-af72-7583a24ff5d6">
     </ri:user>
    </ac:link>
    opened
    <span style="color: rgb(23,43,77);">
     EMC Case #:
     <span>
     </span>
    </span>
    <a class="external-link" href="https://click.notifications.dell.com/?qs=6d0a89a5f491549a1fd298ec858206dc0a936f10cf8c2d26bc45486ef1b6c5c294b0cee16dfa450f2e9feff11e4a0eedf072827fd6feb605843c87eca7d5b6e2" title="Follow link">
     22389018
    </a>
    to get the drive replaced.
   </p>
   <p>
    <span style="letter-spacing: 0.0px;">
     <time datetime="2021-11-18">
     </time>
    </span>
   </p>
   <p>
    <span style="letter-spacing: 0.0px;">
     9:25a pdx-vsr-e02 is put into maintenance mode and all VMs migrated off of it.
     <br/>
     9:35a Support call w/ EMC to ensure that we're following the correct procedure for replacing the failed drive.
     <br/>
     10:12a
     <ac:link>
      <ri:user ri:userkey="557058:037cebc0-7a1a-4a12-af72-7583a24ff5d6">
      </ri:user>
     </ac:link>
     removes disk 0 from the hypervisor physically labeled pdx-vxr-e02
     <br/>
     10:22a PagerDuty alerts that multiple VMs are offline, users note in the IT Hotline that they are not able to reach cgit or opengrok, CJ notes pdx-ad-wv01 is down in SYSMGR chat.
     <br/>
     10:30a Alex notes that the wrong hypervisor (pdx-vxr-e01) is now reporting a missing disk and returns working disk back to hypervisor.
     <br/>
    </span>
    <span style="letter-spacing: 0.0px;">
     10:36a pdx-ad-wv01, pdx-dhcp-wv02, and pdx-util-wv02 alerts clear.
     <br/>
     10:45a Correct disk is located and replaced, pdx-vxr-e02 is returned to service, but users still report cgit and opengrok are not available.
     <br/>
     11:04a Alex reboots pdx-proxy-lv03, cgit and opengrok service are restored.
    </span>
   </p>
   <p>
    <time datetime="2021-11-19">
    </time>
   </p>
   <p>
    <ac:link>
     <ri:user ri:userkey="557058:9290142c-5161-42cc-b65b-d8b8487fa532">
     </ri:user>
    </ac:link>
    notes that Spacewalk is unavailable and
    <ac:link>
     <ri:user ri:userkey="557058:8aff9fa7-fab5-4a58-8371-4bbe29336cd2">
     </ri:user>
    </ac:link>
    restarts pdx-pkgms-mlv01 to restore service.
   </p>
   <h3>
    Corrective Action
   </h3>
   <p>
    I swapped the physical labels on the hypervisors and wrote up a
    <a href="https://schrodinger.atlassian.net/wiki/x/x0RLAw">
     procedure
    </a>
    for doing drive replacements, noting opportunities for error and ways to avoid them.
   </p>
   <h3>
    Analysis
   </h3>
   <p>
    <ac:placeholder>
     Describe any findings (other than this report itself)
    </ac:placeholder>
   </p>
   <p>
    <br/>
   </p>
   <h2>
    Detection
   </h2>
   <hr/>
   <h3>
    How quickly was the problem detected?
   </h3>
   <p>
    The symptoms were noted almost immediately by end users, but it took about 10m to diagnose and another few minutes to correct.
   </p>
   <h3>
    How was the problem detected?
   </h3>
   <p>
    LibreNMS alerted that multiple systems were offline, users noted in IT Hotline specific services that were impacted.
   </p>
   <p>
    The exception being Spacewalk, which was not being monitored by LibreNMS so we didn't know it was down until we tried to use it.
   </p>
   <h3>
    How can detection be improved?
   </h3>
   <p>
    I don't think it could be, other than reducing the time before pages are sent, which would likely increase false positives.
   </p>
   <h2>
    Response
   </h2>
   <hr/>
   <h3>
    How quickly did we respond once detected?
   </h3>
   <p>
    I was working on the issue the entire time, so response was immediate.
   </p>
   <h3>
    Did we adequately communicate to our users?
   </h3>
   <p>
    Users were notified as soon as services had been restored.
   </p>
   <h3>
    If not, how can this be improved?
   </h3>
   <p>
    A dashboard that automatically reports when services are up/down would be a great tool, but ultimately notification that an incident is over should likely come from us.
   </p>
   <p>
    <br/>
   </p>
   <h2>
    Mitigation
   </h2>
   <hr/>
   <h3>
    What went well that helped minimize the impact of this problem?
   </h3>
   <p>
    vCenter noted exactly the problems we were having even though the hypervisors themselves (via iDRAC) did not, which led to immediately identifying the error and quick correction. DHCP leases are long enough that no one noticed issues there.
   </p>
   <h3>
    What can be done to minimize the impact if a problem like this recurs?
   </h3>
   <p>
    Having Cgit and OpenGrok depend on a single VM named pdx-proxy-lv03 seems like an opportunity for improvement.
   </p>
   <h2>
    Avoidance
   </h2>
   <hr/>
   <h3>
    What can we do in the future to avoid a problem like this?
   </h3>
   <p>
    As I noted in the
    <a href="https://schrodinger.atlassian.net/wiki/x/x0RLAw">
     newly written procedure
    </a>
    , it's a good idea to blink the indicator lights on the hosts and drives that you're looking for to eliminate chances for error.
   </p>
   <p>
    I also noted that some special driver bits are required for the VxRail drives, and that it's a good idea to seek current documentation and EMC support for this procedure.
   </p>
   <h2>
    Next Actions
   </h2>
   <hr/>
   <p>
    <ac:placeholder>
     After analyzing and talking about this incident what actions did the reviewers and management decide should be done to address shortfalls in detection, mitigation or avoidance. Use tasks, assignments and due dates or link to created jira tickets.
    </ac:placeholder>
   </p>
   <ac:task-list>
    <ac:task>
     <ac:task-id>
      6
     </ac:task-id>
     <ac:task-status>
      complete
     </ac:task-status>
     <ac:task-body>
      <span class="placeholder-inline-tasks">
       <ac:link>
        <ri:user ri:userkey="557058:037cebc0-7a1a-4a12-af72-7583a24ff5d6">
        </ri:user>
       </ac:link>
       fixed the physical labeling on the hypervisors, noted the changes in Device42, and verified that the other hypervisors are correctly labeled.
      </span>
     </ac:task-body>
    </ac:task>
    <ac:task>
     <ac:task-id>
      7
     </ac:task-id>
     <ac:task-status>
      complete
     </ac:task-status>
     <ac:task-body>
      <span class="placeholder-inline-tasks">
       <ac:link>
        <ri:user ri:userkey="557058:037cebc0-7a1a-4a12-af72-7583a24ff5d6">
        </ri:user>
       </ac:link>
       wrote a procedure for replacing failed disks with instructions to help prevent this recurring:
       <a href="https://schrodinger.atlassian.net/wiki/x/x0RLAw">
        VxRail - Replacing a Failed Drive
       </a>
      </span>
     </ac:task-body>
    </ac:task>
    <ac:task>
     <ac:task-id>
      8
     </ac:task-id>
     <ac:task-status>
      complete
     </ac:task-status>
     <ac:task-body>
      <span class="placeholder-inline-tasks">
       <ac:link>
        <ri:user ri:userkey="557058:037cebc0-7a1a-4a12-af72-7583a24ff5d6">
        </ri:user>
       </ac:link>
       will open a support request with EMC to figure out why the failed drive didn't automatically create an SR and get a replacement drive shipped
      </span>
     </ac:task-body>
    </ac:task>
    <ac:task>
     <ac:task-id>
      1
     </ac:task-id>
     <ac:task-status>
      complete
     </ac:task-status>
     <ac:task-body>
      <span class="placeholder-inline-tasks">
       <ac:link>
        <ri:user ri:userkey="557058:037cebc0-7a1a-4a12-af72-7583a24ff5d6">
        </ri:user>
       </ac:link>
       added pdx-pkgms-lv01 to LibreNMS and added service monitoring for spacewalk
      </span>
     </ac:task-body>
    </ac:task>
    <ac:task>
     <ac:task-id>
      9
     </ac:task-id>
     <ac:task-status>
      complete
     </ac:task-status>
     <ac:task-body>
      <span class="placeholder-inline-tasks">
       <ac:link>
        <ri:user ri:userkey="557058:037cebc0-7a1a-4a12-af72-7583a24ff5d6">
        </ri:user>
       </ac:link>
      </span>
      added HTTPS monitoring for cgit and opengrok and updated
     </ac:task-body>
    </ac:task>
   </ac:task-list>
   <h2>
    Related articles
   </h2>
   <hr/>
   <p>
    <ac:placeholder>
     Related articles appear here based on the labels you select. Click to edit the macro and add or change labels.
    </ac:placeholder>
   </p>
   <p>
    <ac:structured-macro ac:macro-id="ffeb327a-3070-4405-823e-4605184c1568" ac:name="contentbylabel" ac:schema-version="4">
     <ac:parameter ac:name="showLabels">
      false
     </ac:parameter>
     <ac:parameter ac:name="max">
      5
     </ac:parameter>
     <ac:parameter ac:name="spaces">
      SYSMGR
     </ac:parameter>
     <ac:parameter ac:name="showSpace">
      false
     </ac:parameter>
     <ac:parameter ac:name="sort">
      modified
     </ac:parameter>
     <ac:parameter ac:name="reverse">
      true
     </ac:parameter>
     <ac:parameter ac:name="type">
      page
     </ac:parameter>
     <ac:parameter ac:name="cql">
      label = "kb-how-to-article" and type = "page" and space = "SYSMGR"
     </ac:parameter>
     <ac:parameter ac:name="labels">
      kb-how-to-article
     </ac:parameter>
    </ac:structured-macro>
   </p>
   <ac:structured-macro ac:macro-id="b77901a8-fc07-43f9-b345-36673b35c2e9" ac:name="details" ac:schema-version="1">
    <ac:parameter ac:name="hidden">
     true
    </ac:parameter>
    <ac:rich-text-body>
     <p class="auto-cursor-target">
      <br/>
     </p>
     <table class="wrapped">
      <colgroup>
       <col/>
       <col/>
      </colgroup>
      <tbody>
       <tr>
        <th>
         Related issues
        </th>
        <td>
         <br/>
        </td>
       </tr>
      </tbody>
     </table>
     <p class="auto-cursor-target">
      <br/>
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
 </ac:layout-section>
</ac:layout>
