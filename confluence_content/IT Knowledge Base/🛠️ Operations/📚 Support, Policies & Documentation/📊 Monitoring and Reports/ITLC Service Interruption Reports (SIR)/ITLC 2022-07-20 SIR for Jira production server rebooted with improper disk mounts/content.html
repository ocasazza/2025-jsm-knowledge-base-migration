<ac:layout>
 <ac:layout-section ac:type="single">
  <ac:layout-cell>
   <p>
    <ac:placeholder>
     Add labels to this report to make it easy to find outages that relate to the service or the sites that were affected. That will help us find and report on relevant related issues.
    </ac:placeholder>
   </p>
   <ac:structured-macro ac:macro-id="6041cfab-a8b7-40c8-aa32-0229b207b0df" ac:name="excerpt" ac:schema-version="1">
    <ac:parameter ac:name="atlassian-macro-output-type">
     INLINE
    </ac:parameter>
    <ac:rich-text-body>
     <p>
      SIR for Jira production server on
      <time datetime="2022-07-20">
      </time>
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
 </ac:layout-section>
 <ac:layout-section ac:type="two_equal">
  <ac:layout-cell>
   <p class="auto-cursor-target">
    <br/>
   </p>
   <ac:structured-macro ac:macro-id="b2a57857-7f56-44d2-a0d4-91b3d7ebfcbf" ac:name="toc-zone" ac:schema-version="1">
    <ac:rich-text-body>
     <p>
      <ac:structured-macro ac:macro-id="58b18781-a929-4005-a5e0-2ef23adca3fe" ac:name="toc" ac:schema-version="1">
      </ac:structured-macro>
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
  <ac:layout-cell>
   <p class="auto-cursor-target">
    <br/>
   </p>
   <ac:structured-macro ac:macro-id="0db3d9b8-3a8d-4ad4-ae26-0a4ea4bc95c2" ac:name="details" ac:schema-version="1">
    <ac:parameter ac:name="id">
     SIR-metadata
    </ac:parameter>
    <ac:rich-text-body>
     <p class="auto-cursor-target">
      <br/>
     </p>
     <table class="wrapped" style="letter-spacing: 0.0px;">
      <colgroup>
       <col/>
       <col/>
      </colgroup>
      <tbody>
       <tr>
        <th colspan="1">
         System/Service
        </th>
        <td colspan="1">
         <div class="content-wrapper">
          <p>
           <ac:link>
            <ri:page ri:content-title="Jira Server" ri:space-key="SYSMGR">
            </ri:page>
           </ac:link>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th>
         Ticket(s)
        </th>
        <td>
         <div class="content-wrapper">
          <p>
           <ac:structured-macro ac:macro-id="67915725-ec42-48e9-a27f-7ae616f7e751" ac:name="jira" ac:schema-version="1">
            <ac:parameter ac:name="server">
             System JIRA
            </ac:parameter>
            <ac:parameter ac:name="serverId">
             ac6def98-2140-30c3-8103-4b52b8b31135
            </ac:parameter>
            <ac:parameter ac:name="key">
             ITDW-360
            </ac:parameter>
           </ac:structured-macro>
           <ac:structured-macro ac:macro-id="3c5bfc6e-493b-4b0b-886d-d66f84de92a4" ac:name="jira" ac:schema-version="1">
            <ac:parameter ac:name="server">
             System JIRA
            </ac:parameter>
            <ac:parameter ac:name="columnIds">
             issuekey,summary,issuetype,created,updated,duedate,assignee,reporter,priority,status,resolution
            </ac:parameter>
            <ac:parameter ac:name="columns">
             key,summary,type,created,updated,due,assignee,reporter,priority,status,resolution
            </ac:parameter>
            <ac:parameter ac:name="serverId">
             ac6def98-2140-30c3-8103-4b52b8b31135
            </ac:parameter>
            <ac:parameter ac:name="key">
             ITDW-359
            </ac:parameter>
           </ac:structured-macro>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th colspan="1">
         Outage scope
        </th>
        <td colspan="1">
         Production Jira server
        </td>
       </tr>
       <tr>
        <th>
         Outage date
        </th>
        <td>
         <div class="content-wrapper">
          <p>
           <time datetime="2022-07-20">
           </time>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th>
         Report date
        </th>
        <td>
         <div class="content-wrapper">
          <p>
           <time datetime="2022-07-25">
           </time>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th colspan="1">
         Report filed by
        </th>
        <td colspan="1">
         <div class="content-wrapper">
          <p>
           <ac:link>
            <ri:user ri:userkey="557058:dd3ca0b8-81b7-46aa-8e00-307cacc52045">
            </ri:user>
           </ac:link>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th colspan="1">
         Report reviewed date
        </th>
        <td colspan="1">
         <div class="content-wrapper">
          <p>
           <time datetime="2022-08-11">
           </time>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th colspan="1">
         Reviewed by
        </th>
        <td colspan="1">
         SIR Review Board
        </td>
       </tr>
      </tbody>
     </table>
     <p class="auto-cursor-target">
      <br/>
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
 </ac:layout-section>
 <ac:layout-section ac:type="single">
  <ac:layout-cell>
   <h2>
    Executive summary
   </h2>
   <hr/>
   <p>
    While performing a routine but unscheduled reboot of the production Jira server to get the mail processing working again (
    <ac:structured-macro ac:macro-id="9df5885d-ff5f-4fbe-b5f6-9466a64c09a7" ac:name="jira" ac:schema-version="1">
     <ac:parameter ac:name="server">
      System JIRA
     </ac:parameter>
     <ac:parameter ac:name="serverId">
      ac6def98-2140-30c3-8103-4b52b8b31135
     </ac:parameter>
     <ac:parameter ac:name="key">
      ITDW-359
     </ac:parameter>
    </ac:structured-macro>
    ) the server rebooted but with a non-functional configuration of disk devices. This prevented the Jira services from starting and delayed the successful resolution of that incident extending the duration by an extra 50% (30m of ~90m outage).
   </p>
   <h2>
    <span>
     Background
    </span>
   </h2>
   <hr/>
   <p>
    The Jira production server gcp-jira-lv01 is hosted in Google Cloud Platform as a virtual machine. In addition to the system boot disk this VM has two (2) additional virtual disk devices.
   </p>
   <ul>
    <li>
     1.7 TB volume mounted at /dstore that contains the Jira application and non-database files
    </li>
    <li>
     32 GB swap volume
    </li>
   </ul>
   <h2>
    Incident Description
   </h2>
   <hr/>
   <p>
    While working to resolve a problem with failing mail delivery into Jira and after unsuccessfully attempting to restart the Jira services a full-system reboot was initiated. After confirming the system was back up advised users in the IT Support Hotline that it was working only to find that it wasn't.
   </p>
   <p>
    Investigated the systemctl logs to confirm the system wasn't started. Continued investigation uncovered that the two drives expected to be mounted here as /dstore and swap didn't mount properly. Comparing the fdisk output and /etc/fstab file contents established that the devices were presented to the OS by the underlying GCP infrastructure in reverse order to normal.
   </p>
   <h3>
    Chronology
   </h3>
   <p>
    <time datetime="2022-07-20">
    </time>
    19:01 UTC - System reboot initiated with
    <code>
     sudo /sbin/shutdown -r now
    </code>
   </p>
   <p>
    <time datetime="2022-07-20">
    </time>
    19:08 UTC - Users identified Jira service still down
   </p>
   <p>
    <time datetime="2022-07-20">
    </time>
    19:25 UTC - Manually edited /etc/fstab to swap around the device to volume associations
   </p>
   <p>
    <time datetime="2022-07-20">
    </time>
    19:29 UTC - Jira services restarted from command line. Confirmed working.
   </p>
   <p>
    <br/>
   </p>
   <p>
    <span style="font-size: 16.0px;font-weight: bold;letter-spacing: -0.006em;">
     Corrective Action
    </span>
   </p>
   <p>
    This was fixed by manually editing the /etc/fstab to force it to agree with the currently presented order of the devices and manually mounting the devices with
    <code>
     sudo mount -a
    </code>
   </p>
   <p>
    This isn't an appropriate long-term fix but in the moment was deemed advantageous to get the precipitating incident resolved and Jira back in operation.
   </p>
   <h3>
    Analysis
   </h3>
   <p>
    The /etc/fstab file is managed by Ansible and hasn't changed since the system was setup.
   </p>
   <ac:structured-macro ac:macro-id="8a57d1b2-3583-4aef-b137-bc8aeeb116bb" ac:name="panel" ac:schema-version="1">
    <ac:rich-text-body>
     <p>
      root@gcp-jira-lv01:~# stat /etc/fstab
      <br/>
      File: /etc/fstab
      <br/>
      Size: 252             Blocks: 8          IO Block: 4096   regular file
      <br/>
      Device: 801h/2049d      Inode: 530725      Links: 1
      <br/>
      Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
      <br/>
      Access: 2022-07-19 23:26:46.825141331 +0000
      <br/>
      Modify: 2021-11-03 02:09:42.715220203 +0000
      <br/>
      Change: 2021-11-03 02:09:42.715220203 +0000
      <br/>
      Birth: -
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p>
    The system has been rebooted numerous times since inception and this is the first and only time the order of the devices has been different
   </p>
   <ac:structured-macro ac:macro-id="b484cf43-9518-4113-93b3-1df3c0f07e85" ac:name="panel" ac:schema-version="1">
    <ac:rich-text-body>
     <p>
      reboot   system boot  5.15.0-1013-gcp  Wed Jul 20 19:02   still running
      <br/>
      reboot   system boot  5.13.0-1033-gcp  Sat Jul  9 01:01 - 19:02 (11+18:00)
      <br/>
      reboot   system boot  5.13.0-1030-gcp  Sat Jun 11 01:01 - 01:01 (27+23:59)
      <br/>
      reboot   system boot  5.13.0-1025-gcp  Sat May 14 01:01 - 01:01 (27+23:59)
      <br/>
      reboot   system boot  5.13.0-1023-gcp  Sat Apr  9 01:01 - 01:01 (34+23:59)
      <br/>
      reboot   system boot  5.11.0-1028-gcp  Sat Jan 22 08:25 - 01:01 (76+16:36)
      <br/>
      reboot   system boot  5.11.0-1021-gcp  Fri Nov  5 21:00 - 08:24 (77+11:24)
      <br/>
      reboot   system boot  5.11.0-1020-gcp  Tue Nov  2 05:32 - 20:59 (3+15:27)
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p>
    The reboot directly preceding this one did involve an update to kernel 5.15.0 (released
    <time datetime="2021-10-31">
    </time>
    ) . Examination of the
    <a href="https://kernelnewbies.org/Linux_5.15">
     kernel errata
    </a>
    didn't surface any obvious correlations but I'm not a kernel expert.
   </p>
   <h2>
    Detection
   </h2>
   <hr/>
   <h3>
    How quickly was the problem detected?
   </h3>
   <p>
    The problem was detected ~6m after the system restarted
   </p>
   <h3>
    How was the problem detected?
   </h3>
   <p>
    The problem was detected by users who reported Jira was still down past the point it would be expected to be up after restart.
   </p>
   <h3>
    How can detection be improved?
   </h3>
   <p>
    Could have improved detection here by more proactively investigating the Jira services post-reboot. Reboots of this system are routine and Jira service restart failures are relatively rare so I'd moved onto trying to tackle other tasks related to handling the outage instead of doing the basic checks here.
   </p>
   <h2>
    Response
   </h2>
   <hr/>
   <h3>
    How quickly did we respond once detected?
   </h3>
   <p>
    Responded immediately once detected.
   </p>
   <h3>
    Did we adequately communicate to our users?
   </h3>
   <p>
    Communication for the precipitating outage as well as this one took place in the IT Support Hotline chatroom where interested affected users had gathered. A company-wide email announcement didn't seem warranted though as noted in the related SIR we were likely on the cusp of that being necessary in the grand-scheme of things.
   </p>
   <h3>
    If not, how can this be improved?
   </h3>
   <p>
    Adequate for the context and circumstances. As far as I can discern no one else that was affected by the outage reached out to operations or contacted us about this in any other medium.
   </p>
   <h2>
    Mitigation
   </h2>
   <hr/>
   <h3>
    What went well that helped minimize the impact of this problem?
   </h3>
   <p>
    The problem occured during the US workday and IT staff were generally available to field questions and discuss the problem and solutions.
   </p>
   <h3>
    What can be done to minimize the impact if a problem like this recurs?
   </h3>
   <p>
    <ac:placeholder>
     Describe things we could do now, soon or eventually that would make this better if/when it happened again. Don't list things that prevent it--that's avoidance and we'll get to that.
    </ac:placeholder>
   </p>
   <h2>
    Avoidance
   </h2>
   <hr/>
   <h3>
    What can we do in the future to avoid a problem like this?
   </h3>
   <p>
    Change the mechanism by which the filesystems are related to the devices either by using unique identifiers (GUID) or by using the /dev/disk/by-id which
    <ac:link>
     <ri:user ri:userkey="557058:c19c6239-8657-4845-b158-eec62442daf4">
     </ri:user>
    </ac:link>
    notes is presented as defined in GCP. The exact mechanism of the replacement should probably be deferred to
    <ac:link>
     <ri:page ri:content-title="Infrastructure Team" ri:space-key="SYSMGR">
     </ri:page>
    </ac:link>
    to fold into the more general strategy, templates, etc.
   </p>
   <h2>
    Next Actions
   </h2>
   <hr/>
   <p>
    <ac:placeholder>
     After analyzing and talking about this incident what actions did the reviewers and management decide should be done to address shortfalls in detection, mitigation or avoidance. Use tasks, assignments and due dates or link to created jira tickets.
    </ac:placeholder>
   </p>
   <ac:task-list>
    <ac:task>
     <ac:task-id>
      1
     </ac:task-id>
     <ac:task-status>
      complete
     </ac:task-status>
     <ac:task-body>
      <span class="placeholder-inline-tasks">
       <ac:structured-macro ac:macro-id="4399e4fd-dd92-4c6d-bf6a-a4d8f8a073d7" ac:name="jira" ac:schema-version="1">
        <ac:parameter ac:name="server">
         System JIRA
        </ac:parameter>
        <ac:parameter ac:name="serverId">
         ac6def98-2140-30c3-8103-4b52b8b31135
        </ac:parameter>
        <ac:parameter ac:name="key">
         ITINFRA-475
        </ac:parameter>
       </ac:structured-macro>
      </span>
     </ac:task-body>
    </ac:task>
    <ac:task>
     <ac:task-id>
      4
     </ac:task-id>
     <ac:task-status>
      complete
     </ac:task-status>
     <ac:task-body>
      <span class="placeholder-inline-tasks">
       <ac:structured-macro ac:macro-id="2de10bcf-242e-4e64-80c3-8f865179d373" ac:name="jira" ac:schema-version="1">
        <ac:parameter ac:name="server">
         System JIRA
        </ac:parameter>
        <ac:parameter ac:name="serverId">
         ac6def98-2140-30c3-8103-4b52b8b31135
        </ac:parameter>
        <ac:parameter ac:name="key">
         ITINFRA-476
        </ac:parameter>
       </ac:structured-macro>
      </span>
     </ac:task-body>
    </ac:task>
    <ac:task>
     <ac:task-id>
      6
     </ac:task-id>
     <ac:task-status>
      complete
     </ac:task-status>
     <ac:task-body>
      <span class="placeholder-inline-tasks">
       <ac:structured-macro ac:macro-id="ab60580a-8eb8-4fb0-99c1-93a2bd02ed4c" ac:name="jira" ac:schema-version="1">
        <ac:parameter ac:name="server">
         System JIRA
        </ac:parameter>
        <ac:parameter ac:name="serverId">
         ac6def98-2140-30c3-8103-4b52b8b31135
        </ac:parameter>
        <ac:parameter ac:name="key">
         ITINFRA-477
        </ac:parameter>
       </ac:structured-macro>
      </span>
     </ac:task-body>
    </ac:task>
   </ac:task-list>
   <h2>
    Related articles
   </h2>
   <hr/>
   <p>
    <ac:placeholder>
     Related articles appear here based on the labels you select. Click to edit the macro and add or change labels.
    </ac:placeholder>
   </p>
   <p>
    <ac:structured-macro ac:macro-id="ffeb327a-3070-4405-823e-4605184c1568" ac:name="contentbylabel" ac:schema-version="4">
     <ac:parameter ac:name="showLabels">
      false
     </ac:parameter>
     <ac:parameter ac:name="max">
      5
     </ac:parameter>
     <ac:parameter ac:name="spaces">
      SYSMGR
     </ac:parameter>
     <ac:parameter ac:name="showSpace">
      false
     </ac:parameter>
     <ac:parameter ac:name="sort">
      modified
     </ac:parameter>
     <ac:parameter ac:name="reverse">
      true
     </ac:parameter>
     <ac:parameter ac:name="type">
      page
     </ac:parameter>
     <ac:parameter ac:name="cql">
      label = "kb-how-to-article" and type = "page" and space = "SYSMGR"
     </ac:parameter>
     <ac:parameter ac:name="labels">
      kb-how-to-article
     </ac:parameter>
    </ac:structured-macro>
   </p>
   <ac:structured-macro ac:macro-id="b77901a8-fc07-43f9-b345-36673b35c2e9" ac:name="details" ac:schema-version="1">
    <ac:parameter ac:name="hidden">
     true
    </ac:parameter>
    <ac:rich-text-body>
     <p class="auto-cursor-target">
      <br/>
     </p>
     <table class="wrapped">
      <colgroup>
       <col/>
       <col/>
      </colgroup>
      <tbody>
       <tr>
        <th>
         Related issues
        </th>
        <td>
         <br/>
        </td>
       </tr>
      </tbody>
     </table>
     <p class="auto-cursor-target">
      <br/>
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
 </ac:layout-section>
</ac:layout>
