<ac:layout>
 <ac:layout-section ac:type="single">
  <ac:layout-cell>
   <p>
    <ac:placeholder>
     Add labels to this report to make it easy to find outages that relate to the service or the sites that were affected. That will help us find and report on relevant related issues.
    </ac:placeholder>
   </p>
   <ac:structured-macro ac:macro-id="6041cfab-a8b7-40c8-aa32-0229b207b0df" ac:name="excerpt" ac:schema-version="1">
    <ac:parameter ac:name="atlassian-macro-output-type">
     INLINE
    </ac:parameter>
    <ac:rich-text-body>
     <p>
      SIR for Confluence on 2023-05-05
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
 </ac:layout-section>
 <ac:layout-section ac:type="two_equal">
  <ac:layout-cell>
   <p class="auto-cursor-target">
    <br/>
   </p>
   <ac:structured-macro ac:macro-id="b2a57857-7f56-44d2-a0d4-91b3d7ebfcbf" ac:name="toc-zone" ac:schema-version="1">
    <ac:rich-text-body>
     <p>
      <ac:structured-macro ac:macro-id="58b18781-a929-4005-a5e0-2ef23adca3fe" ac:name="toc" ac:schema-version="1">
      </ac:structured-macro>
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
  <ac:layout-cell>
   <p class="auto-cursor-target">
    <br/>
   </p>
   <ac:structured-macro ac:macro-id="0db3d9b8-3a8d-4ad4-ae26-0a4ea4bc95c2" ac:name="details" ac:schema-version="1">
    <ac:parameter ac:name="id">
     SIR-metadata
    </ac:parameter>
    <ac:rich-text-body>
     <p class="auto-cursor-target">
      <br/>
     </p>
     <table class="wrapped" style="letter-spacing: 0.0px;">
      <colgroup>
       <col/>
       <col/>
      </colgroup>
      <tbody>
       <tr>
        <th colspan="1">
         System/Service
        </th>
        <td colspan="1">
         <div class="content-wrapper">
          <p>
           Confluence
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th>
         Ticket(s)
        </th>
        <td>
         <div class="content-wrapper">
          <p>
           <ac:structured-macro ac:macro-id="5ae9fbb7-3ec9-4501-818e-1fff17ffa497" ac:name="jira" ac:schema-version="1">
            <ac:parameter ac:name="server">
             System JIRA
            </ac:parameter>
            <ac:parameter ac:name="columnIds">
             issuekey,summary,issuetype,created,updated,duedate,assignee,reporter,priority,status,resolution
            </ac:parameter>
            <ac:parameter ac:name="columns">
             key,summary,type,created,updated,due,assignee,reporter,priority,status,resolution
            </ac:parameter>
            <ac:parameter ac:name="serverId">
             ac6def98-2140-30c3-8103-4b52b8b31135
            </ac:parameter>
            <ac:parameter ac:name="key">
             ITDW-1495
            </ac:parameter>
           </ac:structured-macro>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th colspan="1">
         Outage scope
        </th>
        <td colspan="1">
         <ac:placeholder>
          If the outage was limited to a site(s) please link to the confluence location page(s)
         </ac:placeholder>
        </td>
       </tr>
       <tr>
        <th>
         Outage date
        </th>
        <td>
         <div class="content-wrapper">
          <p>
           <time datetime="2023-05-05">
           </time>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th>
         Report date
        </th>
        <td>
         <div class="content-wrapper">
          <p>
           <time datetime="2023-05-05">
           </time>
          </p>
         </div>
        </td>
       </tr>
       <tr>
        <th colspan="1">
         Report filed by
        </th>
        <td colspan="1">
         <ac:link>
          <ri:user ri:userkey="5d405c8181cbd30da3475cdf">
          </ri:user>
         </ac:link>
        </td>
       </tr>
       <tr>
        <th colspan="1">
         Report reviewed date
        </th>
        <td colspan="1">
         <ac:placeholder>
          Use // for date macro for the date the report was reviewed with the team or relevant stakeholders
         </ac:placeholder>
        </td>
       </tr>
       <tr>
        <th colspan="1">
         Reviewed by
        </th>
        <td colspan="1">
         <ac:placeholder>
          List of people who had a part in reviewing or commenting on the report
         </ac:placeholder>
        </td>
       </tr>
      </tbody>
     </table>
     <p class="auto-cursor-target">
      <br/>
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
 </ac:layout-section>
 <ac:layout-section ac:type="single">
  <ac:layout-cell>
   <h2>
    Executive summary
   </h2>
   <hr/>
   <p>
    During the scheduled reboot window on Friday May 05 2023 confluence failed to start up. Upon investigation we noticed although confluence was in a failed state there was still a confluence instance running. Which why starting and stopping the instance did not resolve the issue.
   </p>
   <h2>
    <span>
     Background
    </span>
   </h2>
   <hr/>
   <p>
    <ac:placeholder>
     If this incident requires any background knowledge to understand or history that's relevant include it here.
    </ac:placeholder>
   </p>
   <h2>
    Incident Description
   </h2>
   <hr/>
   <p>
    <ac:placeholder>
     Describe the incident in as much (or little) detail as seems appropriate leaving the chronology, corrective action and analysis for their subsequent sub-section(s)
    </ac:placeholder>
   </p>
   <h3>
    Chronology
   </h3>
   <p>
    Reboot and updates occurred at 6pm PDT
    <br/>
    I logged in at 6:04 began troubleshooting
   </p>
   <p>
    6:05 to 6:08
   </p>
   <p>
    Attempted to restart confluence service
   </p>
   <p>
    Notify in chat at 6:28
   </p>
   <p>
    ~7pm
   </p>
   <p>
    We get on a call and Nate notices a confluence process still running
   </p>
   <p>
    We kill the process and restart confluence
   </p>
   <p>
    Confluence starts up
   </p>
   <p>
    7:05
   </p>
   <p>
    Reboot confluence once more to confirm everything is working
   </p>
   <h3>
    Corrective Action
   </h3>
   <p>
    Killed the confluence instance that was running and then ran then restarted the service. This cleared the pid file and started normally. Rebooted confluence server once more to test if it came back up.
   </p>
   <h3>
    Analysis
   </h3>
   <p>
    From the confluence logs it seems two instances of confluence started at the exact same time
   </p>
   <ac:structured-macro ac:macro-id="c15cbbd8-d6c9-4d4c-8e39-92628cd33760" ac:name="code" ac:schema-version="1">
    <ac:plain-text-body>
     <![CDATA[2023-05-06 01:01:47,230 INFO [Catalina-utility-2] [com.atlassian.confluence.lifecycle] contextInitialized Starting Confluence 7.13.11 [build 8703 based on commit hash 85702f9ebeba5f8599040ea751753a092c762fb8] - synchrony version 5.0.3
2023-05-06 01:01:47,212 INFO [Catalina-utility-1] [com.atlassian.confluence.lifecycle] contextInitialized Starting Confluence 7.13.11 [build 8703 based on commit hash 85702f9ebeba5f8599040ea751753a092c762fb8] - synchrony version 5.0.3

]]>
    </ac:plain-text-body>
   </ac:structured-macro>
   <p>
    Right before this it the reboot and upgrades where conducted via the cron job schedule which resulted in the following packages being updated
   </p>
   <ac:structured-macro ac:macro-id="29bd3e51-c39d-4c4d-b833-e83ee57ef799" ac:name="code" ac:schema-version="1">
    <ac:plain-text-body>
     <![CDATA[Start-Date: 2023-05-06  01:00:10
Commandline: apt-get upgrade -y
Upgrade: libsystemd0:amd64 (245.4-4ubuntu3.20, 245.4-4ubuntu3.21), ubuntu-advantage-tools:amd64 (27.13.6~20.04.1, 27.14.4~20.04), udev:amd64 (245.4-4ubuntu3.20, 245.4-4ubuntu3.21), libudev1:amd64 (245.4-4ubuntu3.20, 245.4-4ubuntu3.21), systemd-sysv:amd64 (245.4-4ubuntu3.20, 245.4-4ubuntu3.21), libpam-systemd:amd64 (245.4-4ubuntu3.20, 245.4-4ubuntu3.21), distro-info-data:amd64 (0.43ubuntu1.11, 0.43ubuntu1.13), systemd:amd64 (245.4-4ubuntu3.20, 245.4-4ubuntu3.21), libnss-systemd:amd64 (245.4-4ubuntu3.20, 245.4-4ubuntu3.21), tzdata:amd64 (2023c-0ubuntu0.20.04.0, 2023c-0ubuntu0.20.04.1)
End-Date: 2023-05-06  01:00:33]]>
    </ac:plain-text-body>
   </ac:structured-macro>
   <p>
    <br/>
   </p>
   <p>
    Upon seeing that there was a second process running we killed the process and started up confluence again without issues. during the confluence startup the status reflected that it was able to clear out the current PID file and confluence began without issues.
   </p>
   <p>
    Current theories since syslogs are no longer available.
   </p>
   <ol>
    <li>
     Bad PID file
    </li>
    <li>
     Packages upgraded
    </li>
   </ol>
   <h3>
    Introduced Issues
   </h3>
   <p>
    <ac:placeholder>
     Edit the macro below to replace the issue ID in the JQL query
    </ac:placeholder>
   </p>
   <p>
    <br/>
   </p>
   <h2>
    Detection
   </h2>
   <hr/>
   <h3>
    How quickly was the problem detected?
   </h3>
   <p>
    Pretty quick after the reboot occurred and doing checks
   </p>
   <h3>
    How was the problem detected?
   </h3>
   <p>
    Sid on standby after the weekly reboot occurred.
   </p>
   <h3>
    How can detection be improved?
   </h3>
   <p>
    n/a
   </p>
   <h2>
    Response
   </h2>
   <hr/>
   <h3>
    How quickly did we respond once detected?
   </h3>
   <p>
    Immediately after the weekly reboots
   </p>
   <h3>
    Did we adequately communicate to our users?
   </h3>
   <p>
    This was during the scheduled maintenance window
   </p>
   <h3>
    If not, how can this be improved?
   </h3>
   <p>
    <ac:placeholder>
     Describe here any ways we can or should make our communication better.
    </ac:placeholder>
   </p>
   <h2>
    Mitigation
   </h2>
   <hr/>
   <h3>
    What went well that helped minimize the impact of this problem?
   </h3>
   <p>
    Checking the systems after the weekly reboots.
   </p>
   <h3>
    What can be done to minimize the impact if a problem like this recurs?
   </h3>
   <p>
    Additional documentation for things to check when and what to look for.
   </p>
   <h2>
    Avoidance
   </h2>
   <hr/>
   <h3>
    What can we do in the future to avoid a problem like this?
   </h3>
   <p>
    Ensure we collect syslog if this occurs again and determine based on that what is causing the confluence server to start up twice.
   </p>
   <p>
    Possibly modify this reboot to stop the confluence server before a reboot to clean up pid.
   </p>
   <p>
    Possible solutions would be updating the systemd confluence service to no longer guess the PID file, but to point where it is supposed to be which is /dstore/atlassian/confluence/work/catalina.pid
   </p>
   <p>
    <br/>
   </p>
   <h2>
    Next Actions
   </h2>
   <hr/>
   <p>
    <ac:placeholder>
     After analyzing and talking about this incident what actions did the reviewers and management decide should be done to address shortfalls in detection, mitigation or avoidance. Use tasks, assignments and due dates or link to created jira tickets.
    </ac:placeholder>
   </p>
   <ac:task-list>
    <ac:task>
     <ac:task-id>
      1
     </ac:task-id>
     <ac:task-status>
      incomplete
     </ac:task-status>
     <ac:task-body>
      Write documentation for troubleshooting confluence startup issues.
     </ac:task-body>
    </ac:task>
   </ac:task-list>
   <h2>
    Related articles
   </h2>
   <hr/>
   <p>
    <ac:placeholder>
     Related articles appear here based on the labels you select. Click to edit the macro and add or change labels.
    </ac:placeholder>
   </p>
   <p>
    <ac:structured-macro ac:macro-id="ffeb327a-3070-4405-823e-4605184c1568" ac:name="contentbylabel" ac:schema-version="4">
     <ac:parameter ac:name="showLabels">
      false
     </ac:parameter>
     <ac:parameter ac:name="max">
      5
     </ac:parameter>
     <ac:parameter ac:name="spaces">
      SYSMGR
     </ac:parameter>
     <ac:parameter ac:name="showSpace">
      false
     </ac:parameter>
     <ac:parameter ac:name="sort">
      modified
     </ac:parameter>
     <ac:parameter ac:name="reverse">
      true
     </ac:parameter>
     <ac:parameter ac:name="type">
      page
     </ac:parameter>
     <ac:parameter ac:name="cql">
      label = "kb-how-to-article" and type = "page" and space = "SYSMGR"
     </ac:parameter>
     <ac:parameter ac:name="labels">
      kb-how-to-article
     </ac:parameter>
    </ac:structured-macro>
   </p>
   <ac:structured-macro ac:macro-id="b77901a8-fc07-43f9-b345-36673b35c2e9" ac:name="details" ac:schema-version="1">
    <ac:parameter ac:name="hidden">
     true
    </ac:parameter>
    <ac:rich-text-body>
     <p class="auto-cursor-target">
      <br/>
     </p>
     <table class="wrapped">
      <colgroup>
       <col/>
       <col/>
      </colgroup>
      <tbody>
       <tr>
        <th>
         Related issues
        </th>
        <td>
         <br/>
        </td>
       </tr>
      </tbody>
     </table>
     <p class="auto-cursor-target">
      <br/>
     </p>
    </ac:rich-text-body>
   </ac:structured-macro>
   <p class="auto-cursor-target">
    <br/>
   </p>
  </ac:layout-cell>
 </ac:layout-section>
</ac:layout>
